{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ferremas - Tu ferretería de confianza</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.css"/>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick-theme.css"/>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <style>
    .cart img {
    width: 30px; /* Ajusta el ancho según tu preferencia */
    height: auto; /* Mantén la proporción de la imagen */
  }

  /* Estilos para la ventana emergente del carrito */
  .cart-popup {
    position: absolute;
    top: 60px; /* Ajusta la posición vertical según tu preferencia */
    right: 0;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 5px;
    padding: 10px;
    z-index: 1000; /* Asegura que esté por encima de otros elementos */
    display: none;
    max-height: 300px; /* Altura máxima inicial */
    overflow-y: auto; /* Permitir desplazamiento vertical si hay más contenido */
  }

  .cart-popup.active {
    display: block;
  }

  .cart-popup-content {
    padding: 0; /* Elimina el relleno interno para que el contenido controle la altura */
  }

  /* Estilos para los elementos del carrito */
  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px solid #ddd;
  }

  .cart-item .product-details {
    flex-grow: 1;
    margin-right: 10px;
  }

  .cart-item .quantity input {
    width: 30px;
  }

  .cart-item .quantity button {
    margin-left: 5px;
  }

  /* Estilos para el botón de pago */
  #payButton {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #payButton:hover {
    background-color: #0056b3;
  }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <a href="{% url 'inicio' %}"></a>
      <img src="{% static 'images/ferremasblanco.png' %}" alt="Logo de Ferremas">
    </div>
    <nav>
      <ul>
        <li><a href="{% url 'inicio' %}">Inicio</a></li>
        <li><a href="#productos">Productos</a></li>
        <li><a href="#contacto">Contacto</a></li>
      </ul>
    </nav>
    <div class="user-actions">
      <button id="userBtn">
        <img src="{% static 'images/user_icon_149851-removebg-preview.png' %}" alt="Icono de usuario">
      </button>
      <div id="userDropdown" class="dropdown-content">
        <a href="{% url 'login' %}">Iniciar sesión</a>
        <a href="{% url 'registro' %}">Registrarse</a>
      </div>
      <div class="cart">
        <img src="{% static 'images/carrito.png' %}" alt="Carrito de compras" id="cartIcon">
        <span id="cartCount">0</span>
      </div>
    </div>
  </header>
  <br>
  <section class="carousel">
    <div class="image-container">
      <div class="slick-carousel">
        <div><img src="{% static 'images/1.png' %}" alt="Imagen 1"></div>
        <div><img src="{% static 'images/2.png' %}" alt="Imagen 2"></div>
        <div><img src="{% static 'images/3.png' %}" alt="Imagen 3"></div>
        <div><img src="{% static 'images/4.png' %}" alt="Imagen 4"></div>
      </div>
    </div>
  </section>

  <h1 class="section-title">Nuestros Productos</h1>
  
  <section id="productos" class="products">
    {% for product in products %}
    <div class="product">
      <h3 class="product-name">{{ product.name }}</h3>
      <div class="image-product-container">
        <img src="{% static 'images/Gancho.png' %}" alt="{{ product.name }}">
      </div>
      <div class="product-info">
        <p><strong>Precio:</strong> ${{ product.price }}</p>
        <p><strong>Stock Disponible:</strong> {{ product.stock }} unidades</p>
      </div>
      <button class="add-to-cart-btn" onclick="addToCart('{{ product.name }}', {{ product.price }})">Agregar al carrito</button>
    </div>
    {% empty %}
    <p>No hay productos disponibles.</p>
    {% endfor %}
  </section>

  <!-- Carrito de Compra -->
  <div class="cart-popup" id="cartPopup">
    <div class="cart-popup-content" id="cartPopupContent">
      <h1 class="section-title">Carrito de Compra</h1>
      <section class="cart-items" id="cartItems">
        <!-- Aquí se mostrarán los productos agregados al carrito -->
      </section>
      <div class="total" id="cartTotal">Total a pagar: $0</div>
      <button id="payButton" onclick="pay()">Pagar</button>
    </div>
    <p id="emptyCartMsg" style="display:none;">Aún no has agregado nada al carrito.</p>
  </div>

  <footer id="contacto" class="footer text-lg-start bg-body-tertiary text-muted">
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
      <div class="me-5 d-none d-lg-block">
        <span>Síguenos en nuestras redes:</span>
      </div>
    </section>
  </div>

    <section class="section">
      <div class="container text-center text-md-start mt-5">
  
        <div class="row mt-3">
  
          <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
  
            <h6 class="text-uppercase fw-bold mb-4">
              <i class="fas fa-gem me-3"></i>Ferremas
            </h6>
            <p>
              Ferremas, tu ferretería favorita.
            </p>
            <p>
              Aquí encontrarás todo lo que necesitas.
            </p>
          </div>
  
          <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
  
            <h6 class="text-uppercase fw-bold mb-4">
              Dónde encontrarnos 
            </h6>
            <p>
              <a href="https://www.google.com/maps/@-33.3724682,-70.6695912,3a,75y,97.62h,90t/data=!3m6!1e1!3m4!1srSpjCn9MLhq69UrjcgWwJQ!2e0!7i16384!8i8192?entry=ttu" class="text-reset">Ubicación</a>
            </p>
          </div>
  
          <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
  
            <h6 class="text-uppercase fw-bold mb-4">Contactos</h6>
            <p><i class="fas fa-home me-3"></i> Huechuraba 1232, Santiago, RM</p>
            <p>
              <i class="fas fa-envelope me-3"></i>
              @Ferremas.cl
            </p>
            <p><i class="fas fa-phone me-3"></i> +569 45185452</p>
            <p><i class="fas fa-print me-3"></i> +569 24500063</p>
          </div>
  
        </div>
  
      </div>
    </section>
  
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
      © 2024 Compañía Ferremas:
      <a class="text-reset fw-bold" href="https://youtu.be/dQw4w9WgXcQ">Ferremas.cl</a>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.min.js"></script>
  <script src="{% static 'js/script.js' %}"></script>
  <script>
    // Lógica del carrito de compras
   let cart = [];
   let uniqueProducts = []; // Lista de productos únicos en el carrito
   const cartItemsElement = document.getElementById("cartItems");
   const cartTotalElement = document.getElementById("cartTotal");
   const cartIcon = document.getElementById("cartIcon");
   const cartPopup = document.getElementById("cartPopup");
   const emptyCartMsg = document.getElementById("emptyCartMsg");
   let cartVisible = false;
   
   // Función para agregar un producto al carrito
   function addToCart(name, price) {
     let found = false;
     for (let item of cart) {
       if (item.name === name) {
         item.quantity++;
         found = true;
         break;
       }
     }
     if (!found) {
       cart.push({ name: name, price: price, quantity: 1 });
       if (!uniqueProducts.includes(name)) {
         uniqueProducts.push(name);
       }
     }
     updateCartUI();
   }
   
   // Función para eliminar un producto del carrito
   function removeFromCart(index) {
     const name = cart[index].name;
     cart.splice(index, 1);
     updateUniqueProducts();
     updateCartUI();
   }
   
   // Función para actualizar la cantidad de un producto en el carrito
   function updateQuantity(index, newQuantity) {
     cart[index].quantity = newQuantity;
     if (newQuantity === 0) {
       removeFromCart(index);
     } else {
       updateCartUI();
     }
   }
   
   // Función para actualizar la lista de productos únicos en el carrito
   function updateUniqueProducts() {
     uniqueProducts = [];
     for (let item of cart) {
       if (!uniqueProducts.includes(item.name) && item.quantity > 0) {
         uniqueProducts.push(item.name);
       }
     }
   }
   
   // Función para actualizar la interfaz del carrito
   function updateCartUI() {
     cartItemsElement.innerHTML = "";
     let total = 0;
     let itemCount = uniqueProducts.length;
     for (let i = 0; i < cart.length; i++) {
       const item = cart[i];
       const itemTotal = item.price * item.quantity;
       total += itemTotal;
       const productHTML = `
         <div class="cart-item">
           <div class="product-details">
             <div>${item.name}</div>
             <div>$${item.price.toFixed(2)}</div>
           </div>
           <div class="quantity">
             <span>${item.quantity}</span>
             <input type="number" min="1" value="${item.quantity}" onchange="updateQuantity(${i}, this.value)">
             <button onclick="removeFromCart(${i})">Eliminar</button>
           </div>
         </div>
       `;
       cartItemsElement.innerHTML += productHTML;
     }
     cartTotalElement.textContent = `Total a pagar: $${total.toFixed(2)}`;
     document.getElementById("cartCount").textContent = itemCount === 0 ? '' : itemCount;
     if (cart.length > 0) {
       emptyCartMsg.style.display = "none";
       cartPopup.classList.add("active");
       // Ajustar la altura de la ventana emergente del carrito
       const cartContentHeight = document.getElementById("cartPopupContent").offsetHeight;
       cartPopup.style.height = `${Math.min(cartContentHeight, 300)}px`; // Ajustar a un máximo de 300px
     } else {
       emptyCartMsg.style.display = "block";
       cartPopup.classList.remove("active");
     }
   }
   
   // Función para pagar
   function pay() {
     // Aquí iría la lógica para procesar el pago
     alert("¡Gracias por tu compra!");
     // Limpiar el carrito después del pago
     cart = [];
     uniqueProducts = [];
     updateCartUI();
   }
   
   // Mostrar u ocultar el carrito cuando se hace clic en el ícono del carrito
   cartIcon.addEventListener("click", function() {
     if (cartVisible) {
       cartPopup.classList.remove("active");
     } else {
       cartPopup.classList.add("active");
     }
     cartVisible = !cartVisible;
   });
  </script>
</body>
</html>
